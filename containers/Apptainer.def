Bootstrap: docker
From: carlomt/geant4:11.2.2-almalinux9

%labels
    Author Carlo Mancini
    Email mancinit@infn.it
    Project LowEFrag
    Description "Apptainer container for LowEFrag G4-Med test"

%environment
    export PATH=/opt/geant4/bin:$PATH
    export LD_LIBRARY_PATH=/opt/geant4/lib:$LD_LIBRARY_PATH
    export G4DATA_DIR=/opt/geant4/data
    export G4INSTALL=/opt/geant4
    export LOWEFRAG_HOME=/workspace

%post
    mkdir -p /workspace
    cd /workspace
    # this works only for public repos!
    # We should bind the working dir of the action to a directory here, where all code is and access it from There
    # cp -r /somebindeddir .
    curl -L https://github.com/G4Med-test/@reponame@/archive/refs/heads/@branchname@.tar.gz -o output.tar.gz
    tar -xvzf output.tar.gz --strip-components=1
    rm output.tar.gz

    #mkdir build && cd build
    #cmake ..
    #make -j$(nproc)

    chmod +x runme.sh

%runscript
    echo "Running test application..."
    cd /workspace
    ./runme.sh
